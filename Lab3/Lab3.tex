\documentclass[12pt]{../manual}
%____________________________________________________________________________
%
%	TITLE AND TABLE OF CONTENTS
%____________________________________________________________________________
\begin{document}
\makeheader{Lab 3}{Fall 2019} % Change Semester and Year as needed
\begin{center}
\textbf{\huge ECE 230L - LAB 3}\\~\\
\textbf{\large INTRODUCTION TO CIRCUIT SIMULATION USING PSPICE}\\~\\
\rule{6.5in}{0.5mm}\\
\end{center}

\tableofcontents

\listoffigures

\newpage
%____________________________________________________________________________
%
%	BODY
%____________________________________________________________________________
\section{Objectives of this Laboratory}
The objectives of this laboratory session are to introduce you to the basics of PSpice by learning:
\begin{itemize}
\item How to set-up your PSpice simulation environment,
\item How to represent the circuit elements,
\item How to construct the circuits, and
\item How to simulate the circuits.
\end{itemize}
%____________________________________________________________________________
%
% 	ORCAD
%____________________________________________________________________________
\section{Setting Up a Circuit Using ORCAD Capture}
To create a circuit in a PSpice environment, one must first launch ORCAD:
\begin{enumerate}
\item Open ORCAD Capture CIS
\item Create a new project by selecting {\bf File} $\to$ {\bf New} $\to$ {\bf Project}
\item Name your project `Lab 3'
\item Choose {\bf Analog or Mixed A/D} under the {\bf Create a New Project Using} menu
\item Select {\bf Create a blank project} when prompted
\end{enumerate}

\begin{myfigure}[label=fig:blankSchematic]{Blank Schematic}{Blank Schematic}
\centering
\includegraphics[width=0.9\textwidth]{./figures/BlankSchematic.PNG}
\end{myfigure}

Once the new project has been created, circuit design can begin. Sources, components, ground nodes, and wires can be selected using the {\bf Place} menu.

PSpice will be used to model the circuit in Figure \ref{fig:exampleCircuit} and perform DC, AC, and transient analysis on the circuit.

\begin{myfigure}[label=fig:exampleCircuit]{Example Circuit}{Example Circuit}
\centering
\begin{circuitikz}[scale=2]
\ctikzset{resistors/scale=1.5,batteries/scale=1.5,grounds/scale=2.0,diodes/scale=1.5}
\draw
(0,0) 	to[short] 		++(2,0)
		node[ground] {}
		to[short] 		++(2,0)
		to[C, l_=${C = \SI{1}{\nano\farad}}$]			++(0,2)
		to[short]		++(-2,0)
		to[R, l_=${R_1 = \SI{1}{\kilo\ohm}}$]			++(-2,0)
		to[battery, l_=$v_{in}$]		++(0,-2)
(2,0)	to[R, *-*, l_=${R_2 = \SI{1}{\kilo\ohm}}$]		++(0,2)
;\end{circuitikz}
\end{myfigure}

To make the circuit, 
\begin{enumerate}
\item Add a DC Voltage Source by following \fbox{Place} $\to$ \fbox{PSPice Component} $\to$ \fbox{Source} $\to$ \fbox{Voltage Source} $\to$ \fbox{DC}
\end{enumerate}

Add a DC voltage source to the circuit by following Place $\to$ PSpice Component $\to$ Source $\to$ Voltage Sources $\to$ DC. After adding the voltage source to the schematic, use the Place $\to$ PSpice Components $\to$ Passives menu to insert the remaining resistors and capacitors. Use Ctrl-R to rotate the components. Use Place $\to$ Wire to connect the circuit nodes. To change values of circuit elements, double click on the element and adjust the desired properties. Finally, add a ground node to the circuit schematic. Follow Place $\to$ Ground and select 0/SOURCE as your ground node.
%____________________________________________________________________________
%
%	DC Analysis
%____________________________________________________________________________
\newpage
\section{DC Analysis in PSpice}
To perform a DC analysis of the circuit, you will create a new simulation profile. To create a new profile select \textbf{PSpice} $\to$ \textbf{New Simulation Profile}. Name the new profile `dc' and press \textbf{Create}. To analyze the example circuit, select \textbf{DC Sweep} in the \textbf{Analysis Type} drop down menu and use the following parameters:
\begin{itemize}
\item Sweep variable > Voltage source: V1
\item Sweep Type: Linear
\item Start Value: 0
\item End Value: 10
\item Increment: 0.01
\end{itemize}
Press \textbf{Apply} and \textbf{OK} to save the profile settings. Begin the simulation by selecting \textbf{PSpice} $\to$ \textbf{Run}. To view the circuit behavior at a particular point, follow \textbf{Trace} $\to$ \textbf{Add Trace} to select different values to plot. Plot V(R1:1), V(R1:2), I(R1), and I(R2). Figure \ref{fig:exampleCircuit} shows the circuit schematic and Figure \ref{fig:DCAnalRes} shows the result of DC analysis (top plot: current, bottom plot: voltage).

\begin{myfigure}[label=fig:DCAnalRes]{Result of DC Analysis}{Result of DC Analysis}
\centering
\includegraphics[width=0.9\textwidth]{figures/ResultDCAnalysisCrop.PNG}
\end{myfigure}
%____________________________________________________________________________
%
%	AC Analysis
%____________________________________________________________________________
\newpage
\section{AC Analysis in PSpice}
Before performing an AC analysis a new AC voltage source has to replace the DC source. To change the source, delete the DC source and follow \textbf{Place} $\to$ \textbf{PSpice Component} $\to$ \textbf{Source} $\to$ \textbf{AC}. We include the circuit in Figure \ref{fig:acCircuit}. The following parameters will be used: 
\begin{itemize}
\item DC Value: 10
\item AC Amplitude: 1
\end{itemize}

\begin{myfigure}[colback=white,label=fig:acCircuit]{Circuit for AC Analysis}{Circuit for AC Analysis}
\centering
\includegraphics[width=0.7\textwidth]{figures/ACAnalysisCircuitCrop.PNG}
\end{myfigure}

After the voltage source properties have been changed, AC analysis can be performed. First, create a new simulation profile called `ac'. Next, select \textbf{AC Sweep/Noise} in the \textbf{Analysis Type} drop down menu and use the following parameters:
\begin{itemize}
\item AC Sweep Type: Logarithmic 
\begin{itemize}
\item Select \textbf{Decade} from drop down box below
\end{itemize}
\item Start Frequency: 1k
\item Stop Frequency: 1Meg
\item Number of Points per Decade: 10
\end{itemize}
Press \textbf{Apply} and \textbf{OK} to save the profile settings. Begin the simulation by selecting \textbf{PSpice} $\to$ \textbf{Run}.

A screencap of the settings for the AC Analysis is included in Figure \ref{fig:acSettings}.

\begin{myfigure}[label=fig:acSettings]{Settings for AC Analysis}{Settings for AC Analysis}
\centering
\includegraphics[width=0.6\textwidth]{figures/ACAnalysisSettings.PNG}
\end{myfigure}

\subsection*{Trace Expressions in PSpice}
Trace expressions can be used to plot the phase of a desired value, a parameter in units of dB, or plot other useful mathematical operations on circuit parameters. Trace expressions are available under the \textbf{Trace} $\to$ \textbf{Add Trace} menu. Select \textbf{Plot} $\to$ \textbf{Add Plot to Window} and plot the value of V(R2) in dB. Use the trace expression DB(V(R1:2)). Next, add another plot to the window and plot the phase of V(R2). Use the trace expression P(V(R1:2)). The circuit for AC analysis is shown in Figure \ref{fig:acCircuit} and the resulting plots are shown in Figure \ref{fig:acAnalRes}.

\begin{myfigure}[label=fig:acAnalRes]{Result of AC Analysis}{Result of AC Analysis. Top to bottom: V(R1:2), DB(V(R1:2)), P(V(R1:2)).}
\centering
\includegraphics[width=0.9\textwidth]{figures/ResultACAnalysisCrop.PNG}
\end{myfigure}
%____________________________________________________________________________
%
%	Transient Analysis
%____________________________________________________________________________
\newpage
\section{Transient Analysis in PSpice}

Before performing a transient analysis replace the AC source with a Pulse source (Place-> PSpice Component-> Source-> Pulse). The following parameters will be used to set up the pulse:
\begin{itemize}
\item V1: 0
\item V2: 5
\item TD: 10n
\item TR: 20n
\item TF: 20n
\item PW: 500n
\item PER: 2u
\end{itemize}

\begin{myfigure}[colback=white,label=fig:trans]{Circuit for Transient Analysis}{Circuit for Transient Analysis}
\centering
\includegraphics[width=0.7\textwidth]{figures/TransientAnalysisCircuitCrop.PNG}
\end{myfigure}

Create a new simulation profile called ?Transient?. To analyze the example circuit, select ?Time Domain (Transient)? in the Analysis Type drop down menu and use the following parameters:
? Run to Time: 2u
? Start saving data after: 0
? Maximum step size: 10n
Press ?Apply? and ?OK? to save the profile settings. Begin the simulation by selecting PSpice-> Run. To view the circuit behavior at a particular point, follow Trace-> Add Trace to select different values to plot or use the voltage and current markers indicated in Figure 1. Plot the source voltage and V(R2). The circuit for transient analysis is shown in figure 7 and the resulting plot is shown in figure 8.

\begin{myfigure}[label=fig:transAnalRes]{Result of Transient Analysis}{Result of Transient Analysis}
\centering
\includegraphics[width=0.9\textwidth]{figures/ResultTransientAnalysisCrop.PNG}
\end{myfigure}
%____________________________________________________________________________
%
%	Practice Example
%____________________________________________________________________________
\section{Practice Example}

\begin{myfigure}[label=fig:practice]{Practice Circuit}{Practice Circuit}
\centering
\begin{circuitikz}[scale=2]
\ctikzset{resistors/scale=1.5,batteries/scale=1.5,grounds/scale=2.0,diodes/scale=1.5}
\draw
(0,0) 	to[short, *-] 	++(0,1)
		to[C, l=${C_1=\SI{1}{\nano\farad}}$]	++(2,0)
		to[short, -*]	++(0,-1)
		to[short]		++(1,0)
		to[R, l=${R_{sec}=\SI{1}{\kilo\ohm}}$] 	++(0,-2)
		to[short, -*]		++(-2,0)
		node[ground] {}
		to[short]		++(-2,0)
(2,0)	to[R, l=${R_{fir}=\SI{1}{\kilo\ohm}}$] 	++(-2,0)
		to [short] ++ (-1,0)
		to[battery, l_=${v_{IN}}$, i=${i_{IN}}$] 	++(0,-2)
;\end{circuitikz}
\end{myfigure}
%____________________________________________________________________________
%
%	Exploration
%____________________________________________________________________________
\section{Exploration: Th\'evenin Equivalent Circuits}
\subsection{Purpose}
The purpose of this exercise is to learn how to form a Th\'evenin Equivalent circuit by using circuit parameters obtained during simulation.

\subsection{Introduction}
Any linear DC circuit as seen at a pair of terminals can be reduced to a practical voltage source (an ideal voltage source in series with a resistor).

\begin{myfigure}[label=fig:thev]{Th\'evenin Equivalent Circuit}{Th\'evenin Equivalent Circuit}
\centering
\begin{circuitikz}[scale=2]
\ctikzset{resistors/scale=1.5,batteries/scale=1.5,grounds/scale=2.0,diodes/scale=1.5}
\draw
(0,0)	to[R, *-, l=${R_{TH}}$]		++(-4,0)
		to[battery, l=${V_{OC}}$] 	++(0,-2)
		to[short, -*]	++(4,0)
(0,0.25)	node[] {A}
(0,-1.75)	node[] {B}
;\end{circuitikz}
\end{myfigure}

To form a Th\'evenin Equivalent circuit, two quantities must be calculated, measured, or simulated:
\begin{itemize}
\item $v_{oc}$: The open circuit voltage drop from terminals A to B
\item $i_{sc}$: The short circuit current from terminals A to B
\end{itemize}
Once the values for $v_{oc}$ and $i_{sc}$ have been obtained, the Th\'evenin resistance $R_{TH}$ can be determined using the relation:
\begin{align}
R_{TH} = \frac{v_{oc}}{i_{sc}} \label{eq:rth}
\end{align}
If the circuit contains no dependent sources, then $R_{TH}$ may also be found by turning off all of the independent sources and using resistance reduction at terminals A and B.

\newpage
\subsection{Example Exercise}
Simulate the circuit in Figure \ref{fig:exampleCircuit} and form its Th\'evenin Equivalent as seen from terminals A and B.

\begin{myfigure}[colback=white,label=fig:exampleCircuit]{Example Circuit}{Example Circuit}
\centering
\includegraphics[width=0.7\textwidth]{figures/ExampleCircuitSchematicCrop.PNG}
\end{myfigure}

To find the open circuit voltage, replace resistor $R_4$ with a large ``dummy'' resistance (at least \SI{100}{\mega\ohm}). Create a new simulation profile called ``thev''. Choose \textbf{Bias Point} under the \textbf{Analysis type} menu and check the box labeled \textbf{Include Detailed Bias Point Information} under the \textbf{Output File Options} heading. Press \textbf{Apply} and \textbf{OK} to save the profile. Now, run the simulation. Once the simulation is complete, follow \textbf{PSpice} $\to$ \textbf{Bias Points} and click \textbf{Enable}. Record the voltage across terminals A and B as your open circuit voltage.

\begin{myfigure}[colback=white,label=fig:openCircuit]{Open Circuit Voltage Schematic}{Open Circuit Voltage Schematic}
\centering
\includegraphics[width=0.7\textwidth]{figures/OpenCircuitSchematicCrop.PNG}
\end{myfigure}

To find the short circuit current, remove $R_4$ and connect terminals A and B with a wire.
Use the same ``thev'' simulation profile that was created to find $v_{oc}$. Run the simulation. Once the simulation is complete, enable bias points. This will show the node voltages and currents throughout the circuit. Record the current between terminals A and B as your short circuit current, $i_{sc}$.

\begin{myfigure}[colback=white,label=fig:shortCircuit]{Short Circuit Voltage Schematic}{Short Circuit Voltage Schematic}
\centering
\includegraphics[width=0.7\textwidth]{figures/ShortCircuitSchematicCrop.PNG}
\end{myfigure}

Calculate the Th\'evenin resistance using Equation \ref{eq:rth}. Now, re-create Figure \ref{fig:thev} in PSpice using your $v_{oc}$ and $R_{TH}$ values. Place $R_4$ back into your first circuit and place a resistor of equal value between terminals A and B in your Th\'evenin Equivalent. Run the simulation using the same ``thev'' profile. Once the simulation is complete, enable bias points. Check to make sure the terminal voltages and currents match for both circuits.

\begin{myfigure}[colback=white,label=fig:thevCircuit]{Th\'evenin Equivalent Schematic}{Th\'evenin Equivalent Schematic}
\centering
\includegraphics[width=0.5\textwidth]{figures/TheveninEquivalentExampleCrop.PNG}
\end{myfigure}


\newpage
\subsection{Challenge Exercise: Th\'evenin Equivalent Circuit}
Create the schematic in Figure \ref{fig:exerciseCircuit} using PSpice and find its Th\'evenin Equivalent circuit as seen from nodes A and B. In your lab report, be sure to include all voltages and currents present in the Exercise Circuit and its Th\'evenin Equivalent, as well as a short explanation of each step you took in finding the Th\'evenin Equivalent.
\begin{myfigure}[label=fig:exerciseCircuit]{Exercise Circuit}{Exercise Circuit}
\centering
\begin{circuitikz}
\ctikzset{grounds/scale=1.5}
\draw
(0,0) 	to[short] 		++(4,0)
		node[ground] {}
		to[short] 		++(4,0)
		to[R, l=$R_5$, a=\SI{500}{\ohm}]	++(0,4)
		to[R, l=$R_3$, a=\SI{200}{\ohm}]	++(0,4)
		to[short]		++(-8,0)
		to[battery, a=$V_1$, l=\SI{1}{\volt}]	++(0,-8)
(4,0)	to[R, *-, l=$R_2$, a=\SI{1}{\kilo\ohm}]			++(0,4)
		to[R, -*, l=$R_1$, a=\SI{100}{\ohm}]			++(0,4)
(4,4)	to[R, *-*, l=$R_4$, a=\SI{300}{\ohm}]			++(4,0)
(3.5,4) node[] {A}
(8.5,4) node[] {B}
;\end{circuitikz}
\end{myfigure}
%____________________________________________________________________________
%
%	Grading Rubric
%____________________________________________________________________________
\newpage
\phantomsection % needed in order to link from table of contents to here
\section*{Grading Rubric}
\addcontentsline{toc}{section}{Grading Rubric} % adds section*{} to table of contents
\markboth{Grading Rubric}{Grading Rubric}
\vfill % used to center table vertically on page
\begin{table}[ht!]
\caption{ECE 230L Laboratory 3 Grading Rubric}
\centering
\begin{tabular}{l|c} \hline
Criteria & Points Possible \\ \hline \hline
\textbf{DC Analysis}			& \textbf{10} \\
Circuit Diagram 				& 5 \\
Waveforms 						& 5 \\ \hline
\textbf{AC Analysis}			& \textbf{10} \\
Circuit Diagram 				& 5 \\
Waveforms 						& 5 \\ \hline
\textbf{Transient Analysis}		& \textbf{10} \\
Circuit Diagram 				& 5 \\ 
Waveforms 						& 5 \\ \hline
\textbf{Practice Exercise}		& \textbf{35} \\
Circuit Diagram 				& 5 \\
DC Analysis						& 10 \\
AC Analysis						& 10 \\
Transient Analysis				& 10 \\ \hline
\textbf{Th\'evenin Equivalent Example Circuit} & \textbf{20} \\
Circuit Diagram					& 10 \\
$V_{OC}$ and $I_{SC}$ Labeled	& 5 \\
Correct $R_{TH}$ Value			& 5 \\ \hline
\textbf{Th\'evenin Equivalent Challenge Circuit} & \textbf{15} \\
Circuit Diagram					& 5 \\
$V_{OC}$ and $I_{SC}$ Labeled	& 5 \\
Correct $R_{TH}$ Value			& 5 \\ \hline \hline
Total							& 100 \\ \hline
\end{tabular}
\end{table}
\vfill % used to center table vertically on page
\end{document}
